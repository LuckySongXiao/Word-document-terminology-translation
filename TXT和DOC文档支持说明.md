# TXT和DOC文档支持功能说明

## 概述

翻译系统现已支持 `.txt` 和 `.doc` 格式的文档翻译，扩展了原有的文档处理能力。

## 新增功能

### 1. TXT文本文件支持

#### 功能特点
- **自动编码检测**：支持 UTF-8、GBK、GB2312、UTF-16、ASCII 等多种编码格式
- **智能段落分割**：自动识别段落结构，保持文档格式
- **双语对照输出**：支持原文和译文对照显示
- **仅翻译输出**：可选择只输出翻译结果

#### 处理流程
1. 自动检测文件编码并读取内容
2. 按段落分割文本内容
3. 逐段翻译并保持格式
4. 输出为UTF-8编码的TXT文件

#### 输出格式
- **双语对照模式**：
  ```
  【原文】这是原始文本内容
  【译文】This is the original text content
  
  【原文】下一段内容
  【译文】Next paragraph content
  ```

- **仅翻译模式**：
  ```
  This is the original text content
  Next paragraph content
  ```

### 2. DOC文档支持

#### 功能特点
- **多种转换方式**：支持多种DOC文件读取方法
- **格式保持**：尽可能保持原文档的段落结构
- **DOCX输出**：转换后输出为现代DOCX格式
- **样式支持**：支持基本的文本样式（加粗等）

#### 处理流程
1. 使用多种方法尝试读取DOC文件内容
2. 提取文本并保持段落结构
3. 逐段翻译处理
4. 创建新的DOCX文档并保存

#### 支持的转换方法
1. **docx2txt库**：优先使用，兼容性好
2. **python-docx库**：备用方法
3. **win32com接口**：Windows系统专用，功能最强

## 安装依赖

### 基础依赖（必需）
```bash
pip install python-docx
```

### 增强支持（推荐）
```bash
pip install docx2txt
```

### Windows系统增强（可选）
```bash
pip install pywin32
```

## 使用方法

### 1. Web界面使用

1. **选择文件**：在文件上传区域选择 `.txt` 或 `.doc` 文件
2. **设置参数**：
   - 选择源语言和目标语言
   - 选择是否使用术语库
   - 选择输出格式（双语对照/仅翻译）
3. **开始翻译**：点击"开始翻译"按钮
4. **查看结果**：翻译完成后在输出目录查看结果

### 2. 文件格式要求

#### TXT文件
- **编码**：支持多种编码，推荐使用UTF-8
- **内容**：纯文本内容，支持中英文混合
- **大小**：建议单个文件不超过10MB

#### DOC文件
- **版本**：支持Microsoft Word 97-2003格式
- **内容**：主要处理文本内容，表格和图片会被忽略
- **大小**：建议单个文件不超过50MB

## 输出文件

### TXT翻译输出
- **文件名格式**：`原文件名_双语对照_时间戳.txt` 或 `原文件名_翻译_时间戳.txt`
- **编码**：UTF-8
- **位置**：项目根目录的 `输出` 文件夹

### DOC翻译输出
- **文件名格式**：`原文件名_双语对照_时间戳.docx` 或 `原文件名_翻译_时间戳.docx`
- **格式**：DOCX（Word 2007+）
- **位置**：项目根目录的 `输出` 文件夹

### 附加输出
- **翻译结果Excel**：`原文件名_翻译结果_时间戳.xlsx`
- **使用术语Excel**：`原文件名_使用术语_时间戳.xlsx`（如果启用了术语预处理）

## 注意事项

### TXT文件处理
1. **编码问题**：如果文件编码特殊，可能需要先转换为UTF-8
2. **格式保持**：纯文本文件的格式信息有限，主要保持段落结构
3. **大文件处理**：超大文件可能需要较长处理时间

### DOC文件处理
1. **兼容性**：某些复杂的DOC文件可能无法完全解析
2. **格式丢失**：复杂格式（表格、图片、特殊样式）可能丢失
3. **转换建议**：如果处理失败，建议先将DOC文件另存为DOCX格式

### 通用注意事项
1. **术语库**：建议启用术语库以获得更准确的专业术语翻译
2. **网络连接**：在线翻译服务需要稳定的网络连接
3. **文件备份**：重要文件建议先备份再进行翻译

## 错误处理

### 常见错误及解决方案

#### TXT文件错误
- **编码错误**：尝试使用文本编辑器将文件另存为UTF-8编码
- **读取失败**：检查文件是否损坏或被其他程序占用

#### DOC文件错误
- **无法读取**：
  1. 安装 `docx2txt`：`pip install docx2txt`
  2. Windows系统安装 `pywin32`：`pip install pywin32`
  3. 将DOC文件另存为DOCX格式

#### 翻译错误
- **网络问题**：检查网络连接，尝试切换翻译器
- **文件过大**：将大文件分割为较小的部分分别处理
- **内容问题**：检查文件内容是否包含特殊字符或格式

## 技术实现

### TXT处理器特点
- 多编码自动检测
- 智能段落分割
- 格式保持算法
- 错误恢复机制

### DOC处理器特点
- 多种转换引擎
- 渐进式降级处理
- 格式转换优化
- 兼容性保证

## 更新日志

### v3.2 (2025-01-10)
- ✅ 新增TXT文件支持
- ✅ 新增DOC文件支持
- ✅ 多编码自动检测
- ✅ 智能段落处理
- ✅ 双语对照输出
- ✅ 错误处理优化

---

如有问题或建议，请联系技术支持。
