@echo off
chcp 65001 >nul
title 多格式文档翻译助手 - 调试版封装（带控制台）

echo.
echo ================================================================================
echo                    多格式文档翻译助手 v3.1 - 调试版封装
echo ================================================================================
echo.
echo 📋 调试版特性:
echo ✅ 显示控制台窗口，便于查看异常报错
echo ✅ 详细的调试日志输出
echo ✅ 实时错误信息显示
echo ✅ 包含所有最新修复
echo ✅ 单文件部署，无需安装
echo.

:: 检查当前虚拟环境
echo 🔍 检查当前环境...
if "%CONDA_DEFAULT_ENV%"=="" (
    echo ❌ 错误: 未检测到conda虚拟环境
    echo 请先激活word虚拟环境: conda activate word
    pause
    exit /b 1
)

echo ✅ 当前虚拟环境: %CONDA_DEFAULT_ENV%
echo.

:: 确认开始构建
echo 📦 准备开始调试版本构建...
echo 注意: 调试版本构建可能需要10-15分钟，请确保:
echo   - 网络连接正常
echo   - 有足够的磁盘空间 (至少2GB)
echo   - 关闭杀毒软件的实时保护
echo.
echo ⚠️  调试版本特点:
echo   - 会显示控制台窗口，便于查看详细的运行日志
echo   - 所有异常和错误都会在控制台中显示
echo   - 主要用于问题诊断和调试
echo.
set /p confirm="确认开始构建调试版本? (y/n): "
if /i not "%confirm%"=="y" (
    echo 构建已取消
    pause
    exit /b 0
)

echo.
echo 🚀 开始构建调试版本...
echo.

:: 执行构建
python build_with_console.py

:: 检查构建结果
if %errorlevel% equ 0 (
    echo.
    echo ================================================================================
    echo                              🎉 调试版构建成功完成!
    echo ================================================================================
    echo.
    echo 📁 发布文件位置: release\多格式文档翻译助手_调试版_v3.1_[日期]
    echo 🚀 可执行文件: 多格式文档翻译助手_调试版_v3.1.exe
    echo.
    echo 📋 调试版特性:
    echo ✅ 显示控制台窗口 - 可以看到详细的运行日志和错误信息
    echo ✅ 实时错误输出 - 所有异常都会在控制台中显示
    echo ✅ 调试信息完整 - 包含详细的系统状态和处理过程
    echo ✅ 便于问题定位 - 出现问题时可以直接查看控制台信息
    echo.
    echo 📋 使用方法:
    echo 1. 双击运行可执行文件
    echo 2. 程序会显示两个窗口：控制台窗口和启动器窗口
    echo 3. 控制台窗口显示详细日志，启动器窗口用于操作
    echo 4. 如果出现问题，请查看控制台窗口中的错误信息
    echo.
    echo ⚠️  注意事项:
    echo • 请不要关闭控制台窗口，否则程序会退出
    echo • 控制台窗口中的信息对于问题诊断非常重要
    echo • 如果遇到问题，请截图保存控制台中的错误信息
    echo • 本版本主要用于调试，正式使用建议使用标准版本
    echo.
    echo 📋 下一步:
    echo 1. 测试调试版可执行文件是否正常启动
    echo 2. 验证控制台是否显示详细的运行信息
    echo 3. 测试翻译功能并观察控制台日志
    echo 4. 如果发现问题，记录控制台中的错误信息
    echo.
) else (
    echo.
    echo ================================================================================
    echo                              ❌ 调试版构建失败
    echo ================================================================================
    echo.
    echo 请检查上方的错误信息，常见问题:
    echo 1. 网络连接问题导致依赖下载失败
    echo 2. 磁盘空间不足
    echo 3. 杀毒软件拦截
    echo 4. Python环境问题
    echo 5. 虚拟环境未正确激活
    echo.
    echo 解决方法:
    echo 1. 检查网络连接
    echo 2. 清理磁盘空间
    echo 3. 临时关闭杀毒软件
    echo 4. 重新激活虚拟环境: conda activate word
    echo 5. 重新运行构建脚本
    echo.
)

echo 按任意键退出...
pause >nul
