@echo off
chcp 65001 >nul
title 多格式文档翻译助手 - 单文件版封装

echo.
echo ================================================================================
echo                    多格式文档翻译助手 v3.1 - 单文件版封装
echo ================================================================================
echo.
echo 📋 本次封装特性:
echo ✅ WebSocket连接稳定性修复
echo ✅ 实时日志同步功能
echo ✅ 单文件部署，无需安装
echo ✅ 包含完整虚拟环境
echo ✅ 启动器持续监控功能
echo.

:: 检查当前虚拟环境
echo 🔍 检查当前环境...
if "%CONDA_DEFAULT_ENV%"=="" (
    echo ❌ 错误: 未检测到conda虚拟环境
    echo 请先激活word虚拟环境: conda activate word
    pause
    exit /b 1
)

echo ✅ 当前虚拟环境: %CONDA_DEFAULT_ENV%
echo.

:: 确认开始构建
echo 📦 准备开始单文件版本构建...
echo 注意: 单文件构建可能需要10-15分钟，请确保:
echo   - 网络连接正常
echo   - 有足够的磁盘空间 (至少2GB)
echo   - 关闭杀毒软件的实时保护
echo.
set /p confirm="确认开始构建? (y/n): "
if /i not "%confirm%"=="y" (
    echo 构建已取消
    pause
    exit /b 0
)

echo.
echo 🚀 开始构建单文件版本...
echo.

:: 执行构建
python single_file_build.py

:: 检查构建结果
if %errorlevel% equ 0 (
    echo.
    echo ================================================================================
    echo                              🎉 构建成功完成!
    echo ================================================================================
    echo.
    echo 📁 发布文件位置: release\多格式文档翻译助手_单文件版_v3.1_[日期]
    echo 🚀 可执行文件: 多格式文档翻译助手_单文件版_v3.1.exe
    echo.
    echo 📋 下一步:
    echo 1. 测试可执行文件是否正常启动
    echo 2. 验证Web界面和翻译功能
    echo 3. 检查实时日志同步是否正常
    echo 4. 准备分发给用户
    echo.
) else (
    echo.
    echo ================================================================================
    echo                              ❌ 构建失败
    echo ================================================================================
    echo.
    echo 请检查上方的错误信息，常见问题:
    echo 1. 网络连接问题导致依赖下载失败
    echo 2. 磁盘空间不足
    echo 3. 杀毒软件拦截
    echo 4. 虚拟环境配置问题
    echo.
)

pause
