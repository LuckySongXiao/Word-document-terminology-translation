# 多格式文档翻译助手 - 调试版本构建说明

## 概述

为了帮助用户更好地诊断和排查翻译任务失败等问题，我们创建了一个带控制台的调试版本。这个版本会显示详细的运行日志和错误信息，便于问题定位。

## 调试版本特性

### ✅ 显示控制台窗口
- 程序启动时会显示控制台窗口
- 所有运行日志都会在控制台中实时显示
- 便于查看详细的系统状态和处理过程

### ✅ 详细的调试日志
- 翻译任务提交的详细信息
- 文件处理过程的每个步骤
- WebSocket连接状态和日志传输
- 翻译服务初始化状态

### ✅ 实时错误输出
- 所有异常都会在控制台中显示
- 包含完整的错误堆栈信息
- 便于快速定位问题原因

### ✅ 包含最新修复
- 包含所有最新的bug修复
- 术语库加载JavaScript错误修复
- WebSocket日志处理器增强
- 翻译任务调试日志增强

## 构建方法

### 方法一：使用批处理文件（推荐）

1. **激活虚拟环境**：
   ```bash
   conda activate word
   ```

2. **运行构建脚本**：
   ```bash
   # 双击运行
   build_debug_version.bat
   ```

3. **等待构建完成**：
   - 构建过程需要10-15分钟
   - 请保持网络连接
   - 确保有足够的磁盘空间

### 方法二：使用Python脚本

1. **激活虚拟环境**：
   ```bash
   conda activate word
   ```

2. **运行构建脚本**：
   ```bash
   python build_with_console.py
   ```

## 使用方法

### 启动程序

1. **双击运行**：`多格式文档翻译助手_调试版_v3.1.exe`

2. **观察窗口**：
   - **控制台窗口**：显示详细的运行日志和错误信息
   - **启动器窗口**：图形界面操作窗口

3. **等待启动完成**：
   - 控制台显示 "Web版启动完成！"
   - 浏览器自动打开Web界面

### 问题诊断

当遇到翻译任务失败等问题时：

1. **查看控制台日志**：
   - 翻译任务提交信息
   - 文件保存和处理过程
   - 后台任务执行状态
   - 具体的错误信息

2. **记录关键信息**：
   - 截图保存控制台中的错误信息
   - 记录操作步骤
   - 注意文件类型和大小

3. **常见问题排查**：
   - 检查翻译服务是否初始化成功
   - 确认文件是否正确保存
   - 验证后台任务是否正确提交
   - 查看WebSocket连接状态

## 与标准版本的区别

| 特性 | 标准版本 | 调试版本 |
|------|----------|----------|
| 控制台窗口 | 隐藏 | 显示 |
| 日志输出 | 仅Web界面 | 控制台+Web界面 |
| 错误信息 | 简化显示 | 详细显示 |
| 适用场景 | 正常使用 | 问题诊断 |
| 文件大小 | 相同 | 相同 |

## 注意事项

### ⚠️ 重要提醒

1. **不要关闭控制台窗口**：
   - 关闭控制台窗口会导致程序退出
   - 控制台信息对问题诊断非常重要

2. **保存错误信息**：
   - 遇到问题时请截图保存控制台信息
   - 完整的错误信息有助于技术支持

3. **使用场景**：
   - 调试版本主要用于问题诊断
   - 正常使用建议使用标准版本

### 📋 常见问题

**Q: 为什么有两个窗口？**
A: 控制台窗口用于显示调试信息，启动器窗口用于操作界面。

**Q: 可以关闭控制台窗口吗？**
A: 不建议关闭，关闭后程序会退出。

**Q: 控制台显示很多信息正常吗？**
A: 正常，这些都是调试信息，有助于问题诊断。

**Q: 调试版本和标准版本功能一样吗？**
A: 功能完全一样，只是调试版本会显示更多的运行信息。

## 预期效果

使用调试版本后，当翻译任务失败时，您应该能在控制台中看到：

### 任务提交阶段
```
收到翻译请求: 文件=test.docx, 源语言=auto, 目标语言=zh
生成任务ID: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
保存文件到: /path/to/uploads/test.docx
文件保存成功，大小: 12345 字节
准备提交后台翻译任务:
  - 任务ID: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
  - 输入文件: /path/to/uploads/test.docx
  - 输出文件: /path/to/outputs/test_translated.docx
  - 客户端ID: client_xxxxxxxxx
后台翻译任务已成功提交: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
```

### 任务处理阶段
```
[DEBUG] process_translation 函数被调用，任务ID: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
[DEBUG] process_translation 函数开始执行，任务ID: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
翻译服务状态: 已初始化
=== 开始处理翻译任务 xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx ===
客户端ID: client_xxxxxxxxx
输入文件: /path/to/uploads/test.docx
输出文件: /path/to/outputs/test_translated.docx
...
```

### 错误信息（如果有）
```
[ERROR] 翻译服务未初始化，无法处理翻译任务
[ERROR] 提交后台翻译任务失败: [具体错误原因]
[ERROR] 文件处理失败: [具体错误信息]
```

## 技术支持

如果使用调试版本后仍然遇到问题，请提供：

1. **控制台窗口中的完整错误信息**（截图或文本）
2. **详细的操作步骤描述**
3. **使用的文件类型和大小**
4. **系统环境信息**（Windows版本、Python版本等）

这些信息将帮助我们快速定位和解决问题。
