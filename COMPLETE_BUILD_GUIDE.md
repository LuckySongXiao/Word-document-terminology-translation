# 多格式文档翻译助手 - 完整虚拟环境打包指南

## 概述

本项目提供了完整的虚拟环境打包解决方案，可以将整个Python项目和所有依赖打包成一键启动的EXE可执行文件。

## 新增特性

- ✅ **完整虚拟环境打包** - 包含所有Python依赖和运行时
- ✅ **一键启动** - 双击即可运行，无需安装Python环境
- ✅ **自动Web服务** - 启动后自动打开Web界面
- ✅ **局域网支持** - 支持局域网内多设备访问
- ✅ **错误处理** - 完善的错误处理和日志记录
- ✅ **资源嵌入** - 所有配置文件和资源文件都已嵌入

## 快速开始

### 方法一：快速打包（推荐）

1. **双击运行** `quick_build.bat` 文件
2. **等待完成** - 基于当前环境直接打包
3. **获取结果** - 在 `dist` 目录中查看构建结果

### 方法二：虚拟环境打包（完整版）

1. **双击运行** `pack_with_venv.bat` 文件
2. **等待完成** - 将整个虚拟环境一起打包
3. **获取结果** - 在 `packed_release` 目录和ZIP文件中查看结果

### 方法三：完整构建（高级）

```bash
# 1. 安装依赖
pip install -r requirements_minimal.txt

# 2. 运行构建脚本
python build_complete.py

# 3. 查看结果
cd release
```

## 打包方案对比

| 方案 | 文件 | 特点 | 适用场景 | 文件大小 |
|------|------|------|----------|----------|
| **快速打包** | `quick_build.bat` | 基于当前环境，快速打包 | 开发测试，快速分发 | ~500MB |
| **虚拟环境打包** | `pack_with_venv.bat` | 包含完整虚拟环境 | 生产部署，离线环境 | ~1-2GB |
| **完整构建** | `build_complete.py` | 完整依赖管理和优化 | 正式发布，最终产品 | ~500-800MB |

### 推荐使用场景

- **开发阶段**: 使用快速打包方案
- **测试部署**: 使用虚拟环境打包方案
- **正式发布**: 使用完整构建方案

## 构建流程

构建脚本会自动执行以下步骤：

1. **环境检查** - 验证Python版本和pip
2. **清理目录** - 清理之前的构建文件
3. **安装依赖** - 安装所有必需的Python包
4. **准备文件** - 复制项目文件到构建目录
5. **创建配置** - 生成PyInstaller配置文件
6. **构建EXE** - 使用PyInstaller打包
7. **复制资源** - 添加文档和配置文件
8. **创建发布包** - 生成最终的发布包和ZIP文件

## 构建结果

构建完成后，会在 `release` 目录中生成：

```
release/
├── 多格式文档翻译助手_v3.0_YYYYMMDD/     # 发布目录
│   ├── 多格式文档翻译助手.exe              # 主程序
│   ├── _internal/                         # 内部依赖文件
│   ├── data/                              # 数据目录
│   ├── web/                               # Web界面文件
│   ├── API_config/                        # API配置目录
│   ├── README.md                          # 项目说明
│   ├── 使用说明.md                        # 使用指南
│   ├── 快速开始.txt                       # 快速开始指南
│   └── 版本信息.txt                       # 版本信息
└── 多格式文档翻译助手_v3.0_YYYYMMDD.zip   # ZIP压缩包
```

## 使用方法

### 启动程序

1. **解压ZIP包**（如果使用ZIP分发）
2. **双击** `多格式文档翻译助手.exe`
3. **等待启动** - 程序会自动启动Web服务器
4. **浏览器访问** - 自动打开浏览器访问Web界面

### 局域网访问

程序支持局域网访问：

1. 启动程序后，查看启动日志中的局域网地址
2. 其他设备通过浏览器访问：`http://[主机IP]:8000`
3. 例如：`http://192.168.1.100:8000`

## 技术细节

### 打包配置

- **打包工具**：PyInstaller 6.11.1
- **打包模式**：单文件夹模式（包含所有依赖）
- **启动方式**：无控制台窗口（GUI模式）
- **压缩**：启用UPX压缩减小文件大小
- **图标**：使用项目logo.ico

### 核心依赖

```
# Web框架
fastapi==0.115.4
uvicorn[standard]==0.32.1
websockets==13.1

# AI翻译
openai==0.27.8
ollama==0.4.7

# 文档处理
python-docx==1.1.2
PyMuPDF==1.24.14
openpyxl==3.1.5

# 其他核心依赖
pandas==2.2.3
numpy==1.26.4
Pillow==10.4.0
```

### 隐藏导入

构建脚本自动处理以下隐藏导入：

- 所有项目模块（services, utils, web等）
- Web框架相关模块
- 文档处理库
- AI翻译库
- Windows系统库

## 常见问题

### Q1: 构建失败怎么办？

**检查项目**：
1. Python版本（需要3.8+）
2. 磁盘空间（至少3GB）
3. 网络连接（下载依赖）
4. 杀毒软件设置

**解决方法**：
```bash
# 清理pip缓存
pip cache purge

# 重新安装依赖
pip install -r requirements_clean.txt --force-reinstall

# 手动运行构建
python build_complete.py
```

### Q2: EXE文件很大怎么办？

这是正常现象，因为包含了：
- 完整的Python运行时
- 所有依赖库（包括AI库）
- Web界面资源
- 文档处理库

**文件大小参考**：
- 应用目录：约500-800MB
- ZIP压缩包：约200-400MB

### Q3: 启动速度慢怎么办？

**优化建议**：
- 添加到杀毒软件白名单
- 使用SSD硬盘
- 首次启动会较慢（解压文件）

### Q4: 在其他电脑无法运行？

**系统要求**：
- Windows 10/11 x64
- 至少4GB内存
- 1GB可用磁盘空间

**可能需要安装**：
- Microsoft Visual C++ Redistributable
- .NET Framework 4.8+

## 自定义构建

### 修改依赖

编辑 `requirements_clean.txt` 文件：

```txt
# 添加新依赖
your-package==1.0.0

# 修改版本
existing-package==2.0.0
```

### 修改构建配置

编辑 `build_complete.py` 中的配置：

```python
# 修改版本号
self.version = "3.1"

# 添加隐藏导入
hiddenimports.append('your_module')

# 排除不需要的模块
excludes.append('unnecessary_module')
```

### 添加资源文件

在 `create_pyinstaller_spec()` 方法中添加：

```python
datas.append(('your_resource', 'destination'))
```

## 部署建议

### 单机部署

1. 复制整个发布目录到目标机器
2. 双击EXE文件启动
3. 配置API密钥和术语库

### 企业部署

1. 在服务器上运行程序
2. 配置防火墙开放8000端口
3. 客户端通过浏览器访问
4. 统一配置术语库和API

### 网络部署

1. 使用内网翻译器模式
2. 配置企业级术语库
3. 设置访问权限控制

## 更新维护

### 版本更新

1. 修改源代码
2. 更新版本号
3. 重新运行构建脚本
4. 分发新版本

### 配置更新

- **API配置**：修改 `API_config` 目录
- **术语库**：修改 `data/terminology.json`
- **Web界面**：修改 `web` 目录文件

## 技术支持

如遇问题，请：

1. 查看 `build.log` 构建日志
2. 检查 `快速开始.txt` 使用说明
3. 参考项目文档
4. 联系技术支持

---

**版本**：3.0
**更新日期**：2024年12月
**兼容性**：Windows 10/11 x64
**构建工具**：PyInstaller 6.11.1
